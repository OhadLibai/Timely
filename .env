# ===================================================================
# UPDATED .env FILE - Enhanced TIFU-KNN Configuration
# ===================================================================

# -------------------------
# GENERAL APP CONFIG
# -------------------------
NODE_ENV=development
APP_NAME=Timely
APP_VERSION=1.0.0

# -------------------------
# DEVELOPMENT SETTINGS
# -------------------------
DEBUG=false
ENVIRONMENT=development
LOG_LEVEL=INFO

# -------------------------
# SECURITY & AUTH
# -------------------------
JWT_SECRET=your-super-secret-jwt-key-for-dev-that-is-at-least-32-chars
JWT_REFRESH_SECRET=your-super-secret-jwt-refresh-key-for-dev-that-is-32-chars
JWT_ACCESS_TOKEN_EXPIRY=24h

# -------------------------
# SERVICE PORTS
# -------------------------
FRONTEND_PORT=3000
BACKEND_PORT=5000
ML_SERVICE_PORT=8000
DB_EXPOSED_PORT=5432

# -------------------------
# SERVICE URLS
# -------------------------
FRONTEND_URL=http://localhost:3000
BACKEND_URL=http://backend:5000
VITE_API_URL=http://localhost:5000/api
ML_SERVICE_URL=http://ml-service:8000

# -------------------------
# API RATE LIMITING
# -------------------------
RATE_LIMIT_WINDOW_MS=900000

# -------------------------
# DATABASE CONFIG
# -------------------------
POSTGRES_USER=timely_user
POSTGRES_PASSWORD=timely_password
POSTGRES_DB=timely_db
DB_HOST=database
DB_PORT=5432
DATABASE_URL=postgresql://user:password@database:5432/timely_db

# ===================================================================
# ENHANCED ML SERVICE CONFIG - TIFU-KNN ALGORITHM
# ===================================================================

# -------------------------
# DATA PATHS
# -------------------------
DATASET_PATH=/app/dataset   # Raw Instacart CSV files
DATA_PATH=/app/data         # Processed data (JSONs)
MODELS_DIR=/app/data/models # Pre-fitted model files

# -------------------------
# CORE TIFU-KNN PARAMETERS (matching reference implementation)
# -------------------------
TIFUKNN_NEIGHBORS=900              # Number of neighbors (900 for Instacart dataset)
TIFUKNN_WITHIN_DECAY=0.9           # α: Within-group temporal decay rate
TIFUKNN_GROUP_DECAY=0.7            # β: Across-group decay rate  
TIFUKNN_SEQUENTIAL_DECAY=0.9       # γ: Sequential basket decay rate
TIFUKNN_GROUP_SIZE=3               # Number of frequency groups

# -------------------------
# CONFIGURABLE K PARAMETERS - Admin can tune these
# -------------------------
TIFUKNN_TOP_K_DEFAULT=20           # Default K for predictions
TIFUKNN_TOP_K_MIN=5                # Minimum allowed K value
TIFUKNN_TOP_K_MAX=50               # Maximum allowed K value

# Context-specific K values for different use cases
TIFUKNN_K_PRECISION=10             # K for precision-focused predictions
TIFUKNN_K_RECALL=50                # K for recall-focused predictions  
TIFUKNN_K_BALANCED=20              # K for balanced precision/recall
TIFUKNN_K_QUICK=5                  # K for quick evaluation/testing

# -------------------------
# EVALUATION CONFIGURATION
# -------------------------
EVALUATION_RANDOM_SEED=42          # Random seed for reproducible evaluation
EVALUATION_SAMPLE_SIZE=1000        # Default sample size (omit for all users)

# K values for comprehensive evaluation (comma-separated)
TIFUKNN_EVAL_K_VALUES=5,10,20,50   # Multiple K values for evaluation

# Context-specific evaluation K values
EVAL_K_OVERALL=20                  # K for overall performance evaluation
EVAL_K_PRECISION=10                # K for precision-focused evaluation  
EVAL_K_RECALL=50                   # K for recall-focused evaluation
EVAL_K_QUICK=5                     # K for quick development evaluation

# -------------------------
# ALGORITHM ENHANCEMENT OPTIONS
# -------------------------
TIFUKNN_FREQ_METHOD=equal_division  # Frequency grouping: equal_division, kmeans, quantile
TIFUKNN_STRATIFIED_EVAL=true       # Enable stratified evaluation sampling
TIFUKNN_TEMPORAL_PATTERNS=true     # Enable enhanced temporal pattern detection
TIFUKNN_CACHE_PROFILES=true        # Cache user profiles for performance

# -------------------------
# MODEL PERSISTENCE & FITTING
# -------------------------
USE_PRE_FITTED_MODEL=false         # Use pre-fitted model files (set true for production)
AUTO_FIT_ON_STARTUP=true           # Auto-fit model on service startup
FITTED_MODEL_FILE=tifuknn_fitted_model.pkl

# -------------------------
# API CONFIGURATION  
# -------------------------
API_MAX_K=100                      # Maximum K allowed via API requests
API_DEFAULT_K=20                   # Default K for API requests
API_ENABLE_CSV_PRED=true           # Enable CSV-based predictions
API_ENABLE_DB_PRED=true            # Enable database-based predictions

# ===================================================================
# IMPLEMENTATION NOTES
# ===================================================================

# 1. CONFIDENCE CALCULATIONS: Completely removed from entire codebase
# 2. EVALUATION CONTEXTS: Different K values for different evaluation purposes
# 3. TEMPORAL FEATURES: Enhanced temporal pattern detection using Instacart features
# 4. OFFLINE FITTING: Run scripts/fit_tifuknn_model.py to generate model files
# 5. K PARAMETER TUNING: Admin can adjust K values to optimize performance

# ===================================================================
# QUICK START CONFIGURATION EXAMPLES
# ===================================================================

# For development/testing (faster, smaller K values):
# TIFUKNN_TOP_K_DEFAULT=10
# TIFUKNN_EVAL_K_VALUES=5,10,15
# EVALUATION_SAMPLE_SIZE=100

# For production (optimal performance):
# TIFUKNN_TOP_K_DEFAULT=20
# TIFUKNN_EVAL_K_VALUES=5,10,20,50
# USE_PRE_FITTED_MODEL=true
# EVALUATION_SAMPLE_SIZE=5000

# For research/evaluation (comprehensive analysis):
# TIFUKNN_TOP_K_DEFAULT=20
# TIFUKNN_EVAL_K_VALUES=5,10,15,20,25,30,50
# EVALUATION_SAMPLE_SIZE=    # (empty = all users)